{{ define "severity_firing_payload" -}}

{
  "status": "firing",
  "receiver": "{{ .Receiver }}",
  "orgId": {{ (index .Alerts 0).OrgID }},
  "payload": [
    {{- $first := true -}}
    {{- range .Alerts -}}
      {{- if eq .Status "firing" -}}
        {{- if not $first }},{{ end -}}
        {
          "alertname": "{{ .Labels.alertname }}",
          "severity": "{{ with .Labels.severity }}{{ . }}{{ else }}minor{{ end }}",
          "status": "{{ .Status }}",
          "summary": "{{ with .Annotations.summary }}{{ . }}{{ else }}{{ end }}",
          "description": "{{ with .Annotations.description }}{{ . }}{{ else }}{{ end }}",
          "instance": "{{ with .Labels.instance }}{{ . }}{{ else }}{{ end }}",
          "job": "{{ with .Labels.job }}{{ . }}{{ else }}{{ end }}",
          "startsAt": "{{ .StartsAt }}",
          "endsAt": "{{ .EndsAt }}",
          "generatorURL": "{{ .GeneratorURL }}",
          "dashboardURL": "{{ with .DashboardURL }}{{ . }}{{ else }}{{ end }}",
          "panelURL": "{{ with .PanelURL }}{{ . }}{{ else }}{{ end }}",
          "runbookURL": "{{ with .Annotations.runbook_url }}{{ . }}{{ else }}{{ end }}"
        }
        {{- $first = false -}}
      {{- end -}}
    {{- end }}
  ]
}

{{- end }}
