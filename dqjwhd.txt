{{ define "severity_firing_payload" -}}

{{/* Initialize an empty list for all firing alerts */}}
{{ $payload := coll.Slice }}

{{ range .Alerts }}
  {{ if eq .Status "firing" }}
    {{ $severity := .Labels.severity }}
    {{ if not $severity }}
      {{/* default to minor if missing */}}
      {{ $severity = "minor" }}
    {{ end }}

    {{ $payload = coll.Append (coll.Dict
        "alertname" .Labels.alertname
        "severity" $severity
        "status" .Status
        "summary" .Annotations.summary
        "description" .Annotations.description
        "instance" .Labels.instance
        "job" .Labels.job
        "startsAt" .StartsAt
        "endsAt" .EndsAt
        "generatorURL" .GeneratorURL
        "dashboardURL" .DashboardURL
        "panelURL" .PanelURL
        "runbookURL" .Annotations.runbook_url
    ) $payload }}
  {{ end }}
{{ end }}

{{/* Create the final JSON output */}}
{{ $data := coll.Dict
    "status" "firing"
    "receiver" .Receiver
    "orgId" (index .Alerts 0).OrgID
    "firingCount" (len $payload)
    "payload" $payload
}}

{{ $data | data.ToJSONPretty "  " }}
{{- end }}
